import { IMinimalOfflineAudioContext, IOfflineAudioContext } from 'standardized-audio-context/src/interfaces/index';
import { TContext, TGetNativeContextFactory, TNativeAudioContext, TNativeOfflineAudioContext } from 'standardized-audio-context/src/types/index';
import { createInvalidStateError } from 'standardized-audio-context/src/factories/invalid-state-error';

export const createGetNativeContext: TGetNativeContextFactory = (contextStore) => {
    return <T extends TContext>(
        context: T
    ): T extends IMinimalOfflineAudioContext | IOfflineAudioContext ? TNativeOfflineAudioContext : TNativeAudioContext => {
        const nativeContext = contextStore.get(context);

        if (nativeContext === undefined) {
            throw createInvalidStateError();
        }

        return <T extends IMinimalOfflineAudioContext | IOfflineAudioContext ? TNativeOfflineAudioContext : TNativeAudioContext>(
            nativeContext
        );
    };
};
