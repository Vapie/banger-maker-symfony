import { ACTIVE_AUDIO_NODE_STORE } from 'standardized-audio-context/src/globals';
import { IAudioNode } from 'standardized-audio-context/src/interfaces/index';
import { TContext } from 'standardized-audio-context/src/types/index';
import { getEventListenersOfAudioNode } from 'standardized-audio-context/src/helpers/get-event-listeners-of-audio-node';

export const setInternalStateToPassive = <T extends TContext>(audioNode: IAudioNode<T>) => {
    if (!ACTIVE_AUDIO_NODE_STORE.has(audioNode)) {
        throw new Error('The AudioNode is not stored.');
    }

    ACTIVE_AUDIO_NODE_STORE.delete(audioNode);

    getEventListenersOfAudioNode(audioNode).forEach((eventListener) => eventListener(false));
};
