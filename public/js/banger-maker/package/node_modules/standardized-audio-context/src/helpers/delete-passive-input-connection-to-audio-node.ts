import { IAudioNode } from 'standardized-audio-context/src/interfaces/index';
import { TContext, TPassiveAudioNodeInputConnection } from 'standardized-audio-context/src/types/index';
import { getValueForKey } from 'standardized-audio-context/src/helpers/get-value-for-key';
import { pickElementFromSet } from 'standardized-audio-context/src/helpers/pick-element-from-set';

export const deletePassiveInputConnectionToAudioNode = <T extends TContext>(
    passiveInputs: WeakMap<IAudioNode<T>, Set<TPassiveAudioNodeInputConnection>>,
    source: IAudioNode<T>,
    output: number,
    input: number
) => {
    const passiveInputConnections = getValueForKey(passiveInputs, source);
    const matchingConnection = pickElementFromSet(
        passiveInputConnections,
        (passiveInputConnection) => passiveInputConnection[0] === output && passiveInputConnection[1] === input
    );

    if (passiveInputConnections.size === 0) {
        passiveInputs.delete(source);
    }

    return matchingConnection;
};
